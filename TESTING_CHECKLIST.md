# 系统功能测试清单

## 🔍 测试范围
涵盖所有核心功能模块的端到端测试

---

## ✅ 后端功能测试

### 服务启动与基础 API
- [ ] **根路由测试**
  ```bash
  curl http://localhost:3001
  # 预期: JSON 响应 {status: 'ok', service: '...', endpoints: {...}}
  ```

- [ ] **健康检查**
  ```bash
  curl http://localhost:3001/health
  # 预期: {"status":"healthy"}
  ```

- [ ] **CORS 配置**
  - 前端能请求后端 (检查浏览器 NetworkTab，无 CORS 错误)

### 表格 API
- [ ] `GET /api/tables` - 返回12张台的初始列表
- [ ] `POST /api/tables/:id/state` - 更新台位状态 (start/stop/clean)
- [ ] `POST /api/tables/merge` - 合并台位 (台1并入台2)
- [ ] `POST /api/tables/:id/unmerge` - 解除合并

### 其他模块 API
- [ ] `GET /api/reservations` - 预约列表
- [ ] `POST /api/reservations` - 创建预约
- [ ] `GET /api/members` - 会员列表
- [ ] `POST /api/members` - 创建会员
- [ ] `GET /api/inventory` - 库存列表
- [ ] `GET /api/staff` - 员工列表
- [ ] `GET /api/transactions` - 交易记录
- [ ] `GET /api/transactions/export/csv` - CSV导出

### WebSocket
- [ ] 客户端能连接 ws://localhost:3001
- [ ] 接收初始化消息 (tables 数据)
- [ ] 发送 table 更新时，所有连接都收到广播

---

## 🎨 前端功能测试

### Dashboard (桌位地图)
- [ ] **显示与交互**
  - [ ] 12张台位卡片正确显示
  - [ ] 台位颜色反映状态 (闲 绿, 占用 红, 预留 蓝, 已并入 黄)
  - [ ] 计时器正确运行 (MM:SS 格式)
  - [ ] 费用计算正确 (RM 0.5/分钟)

- [ ] **拖拽合并**
  - [ ] 拖台1 → 台2 时显示"合并中..."提示
  - [ ] 成功后显示"✓ 台位 1 已并入台位 2"
  - [ ] 台1卡片变灰显示 "已并入台 2"
  - [ ] 台2显示 "并入: 1"
  - [ ] 刷新后状态持久化

- [ ] **表格详情模态框**
  - [ ] 点击台位卡片打开模态
  - [ ] 显示大计时器与成本
  - [ ] 快捷按钮 (加单/结账/切换) 可点击

### Checkout (结账)
- [ ] **费用计算**
  - [ ] 台位费 = 使用时间 (分钟) × 0.5 RM/分钟
  - [ ] 订单费 = 购物车商品总额
  - [ ] 优惠扣除正确
  - [ ] 合计应收 = 二者相加 - 优惠

- [ ] **支付方式**
  - [ ] 4种支付方式可选 (现金、刷卡、电子钱包、银行转账)
  - [ ] 点"确认支付"后不报错
  - [ ] 交易成功后返回 Dashboard

### Reservations (预约管理)
- [ ] **表单与新增**
  - [ ] 能输入姓名、电话、日期、时间、人数、台型、定金
  - [ ] 提交后列表更新，显示新预约
  - [ ] localStorage 持久化

- [ ] **标签页**
  - [ ] 切换 "待处理" / "已完成" / "已取消"
  - [ ] 计数器显示各状态数量
  - [ ] 状态转换 (待处理 → 已完成 / 已取消)

### Members (会员管理)
- [ ] **创建会员**
  - [ ] 填写姓名、电话、等级、初始余额
  - [ ] 成功后显示"✓ 会员已创建"

- [ ] **充值流程**
  - [ ] 点"充值"按钮打开对话框
  - [ ] 输入金额后确认
  - [ ] 余额更新正确

- [ ] **会员列表**
  - [ ] 显示所有会员信息 (姓名、电话、等级、余额、积分、消费额)
  - [ ] 等级色彩标记 (银/金/铂)

### Inventory (库存管理)
- [ ] **入库**
  - [ ] 输入物料名、数量、单位、分类、最低库存
  - [ ] 成功添加后显示在表格

- [ ] **库存状态**
  - [ ] 数量 ≤ 最低值 → 红色"低库存"
  - [ ] 数量 > 最低值 且 ≤ 2×最低值 → 黄色"预警"
  - [ ] 数量 > 2×最低值 → 绿色"正常"

- [ ] **出库与补货**
  - [ ] 点"出库"输入数量并确认，库存减少
  - [ ] 点"补货"库存增加至 3×最低值

- [ ] **低库存警告**
  - [ ] 顶部显示低库存项目列表

### Transactions (交易流水)
- [ ] **统计汇总**
  - [ ] 显示总收入、总支出、总交易数

- [ ] **筛选**
  - [ ] 按类型筛选 (全部、订单、充值、退款)
  - [ ] 关键词搜索 (金额、台位等)

- [ ] **CSV导出**
  - [ ] 点"导出 CSV"下载文件
  - [ ] 文件包含时间、类型、支付方式、金额等字段

### Queue (等候队列)
- [ ] **加入队列**
  - [ ] 输入客户名、电话、人数，加入队列
  - [ ] 显示在"当前队列"列表中，位置正确

- [ ] **通知与操作**
  - [ ] 点"►通知下一位"后，第一位客户移到"已通知"列表
  - [ ] 后续客户位置重新编号
  - [ ] 显示通知时间

- [ ] **队列管理**
  - [ ] "后移"按钮将客户移到队列末尾
  - [ ] "删除"按钮移除客户

### Staff (员工管理)
- [ ] **添加员工**
  - [ ] 输入姓名、电话、职位、月薪、入职日期
  - [ ] 成功添加显示"✓ 员工已添加"

- [ ] **在职/离职**
  - [ ] 在职员工显示在上方表格
  - [ ] 点"离职"后移到离职表格
  - [ ] 离职员工可"重新聘用"

### Rates (计费策略)
- [ ] **创建策略**
  - [ ] 输入策略名、基础费率、时段、倍率
  - [ ] 显示在列表中

- [ ] **价格参考**
  - [ ] 参考表自动计算15/30/60/120分钟的价格
  - [ ] 公式: 基础费率 × 倍率 × 分钟数

### Settings (系统设置)
- [ ] **计费标签**
  - [ ] 修改时均费率、税率、货币
  - [ ] 显示15分钟费用示例

- [ ] **商户信息**
  - [ ] 输入店名、电话、地址、营业时间
  - [ ] "保存设置"后持久化到 localStorage

- [ ] **支付方式**
  - [ ] 可勾选/取消各支付方式

- [ ] **备份与安全**
  - [ ] 能选择备份频率
  - [ ] 显示安全提示与建议

### CartSidebar (购物车侧栏)
- [ ] **菜单展开**
  - [ ] 点"展开菜单"显示菜品列表
  - [ ] 点菜品添加到购物车

- [ ] **购物车操作**
  - [ ] ➕ ➖ 按钮调整数量
  - [ ] ✕ 按钮删除项目
  - [ ] 小计正确计算

- [ ] **结算链接**
  - [ ] 点"去结算 →"跳转到 Checkout 页面
  - [ ] 菜品信息正确传递

---

## 🔄 集成测试

### 完整订单流程
1. [ ] Dashboard 选择台位 5
2. [ ] 在台位 5 上启动计时
3. [ ] 等待 2-3 分钟
4. [ ] 打开 CartSidebar，选择 2 项菜品
5. [ ] 点"去结算"进入 Checkout
6. [ ] 验证费用计算 (台位费 + 菜品费)
7. [ ] 选择支付方式"现金"
8. [ ] 点"确认支付"
9. [ ] 验证交易记录出现在 Transactions 页面

### 合并订单流程
1. [ ] 启动台 1 和台 2 计时
2. [ ] 拖台 1 → 台 2
3. [ ] 验证合并成功 (台 1 灰化，台 2 显示 mergedWith)
4. [ ] 在 Checkout 时，费用应为两张台的累计时间
5. [ ] 验证后端数据正确保存

### 会员充值与消费
1. [ ] 创建会员 "Tom" (初始余额 0)
2. [ ] 充值 100 RM
3. [ ] 验证余额更新为 100
4. [ ] 完成订单结账
5. [ ] 验证消费额累计在会员记录

### 库存与订单关联 (待实现)
- 当订单完成时，菜品对应库存自动减少

---

## 🐛 常见问题排查

### 后端无法启动
```bash
# 检查端口占用
netstat -tulpn | grep 3001  # Linux/Mac
netstat -ano | findstr :3001  # Windows

# 尝试不同端口修改 backend/server.js 的 app.listen(3001,...)
```

### 前端无法连接后端
- [ ] 检查浏览器开发工具 (F12 → Network)
- [ ] 查看是否有 CORS 错误
- [ ] 确保后端已启动且健康检查通过

### WebSocket 连接失败
```javascript
// 在浏览器控制台测试:
const ws = new WebSocket('ws://localhost:3001')
ws.onopen = () => console.log('✓ 已连接')
ws.onerror = (e) => console.error('✗ 连接失败', e)
```

### 数据不持久化
- [ ] 检查 localStorage: `localStorage.getItem('pool_tables_v1')`
- [ ] 检查后端数据文件: `backend/data/*.json`
- [ ] 浏览器隐私模式禁用 localStorage，改用正常模式

---

## 📊 性能测试

- [ ] 12 张台位同时计时，页面流畅无卡顿
- [ ] 开启 50 笔交易记录，表格加载 < 1 秒
- [ ] 1000 行库存项目，搜索响应 < 500ms
- [ ] WebSocket 消息延迟 < 100ms

---

## 🎯 备注

- 所有测试应在 Chrome 或 Firefox 最新版本中进行
- 测试前建议清除 localStorage: `localStorage.clear()`
- 如发现 bug，记录：操作步骤、预期结果、实际结果、浏览器版本

---

**测试完成时间**: ___________  
**测试人员**: ___________  
**总体评分**: ⭐⭐⭐⭐⭐ / 5  
**备注**: ___________
